<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Museum Dataset Admin</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 20px; }
    h1 { margin-bottom: 8px; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    textarea { width: 100%; min-height: 200px; font-family: ui-monospace, monospace; }
    label { font-weight: 600; }
    .actions { margin-top: 16px; }
    .status { margin-top: 8px; color: #444; }
    .note { font-size: 12px; color: #666; }
  </style>
</head>
<body>
  <h1>Museum Items Dataset Admin</h1>
  <p class="note">Paste one item per line for each category. Canonical names preferred (e.g., "Aspect of the End").</p>
  <div class="grid">
    <div>
      <label for="weapons">Weapons</label>
      <textarea id="weapons" placeholder="One item per line..."></textarea>
    </div>
    <div>
      <label for="armor">Armor Sets</label>
      <textarea id="armor" placeholder="One item per line..."></textarea>
    </div>
    <div>
      <label for="accessories">Accessories</label>
      <textarea id="accessories" placeholder="One item per line..."></textarea>
    </div>
    <div>
      <label for="special">Special</label>
      <textarea id="special" placeholder="One item per line..."></textarea>
    </div>
  </div>
  <div class="actions">
    <button id="save">Save Dataset</button>
    <div id="status" class="status"></div>
  </div>

  <script>
    function linesToArray(text) {
      return (text || '')
        .split(/\r?\n/)
        .map(s => s.trim())
        .filter(Boolean);
    }

    async function saveDataset() {
      const items = {
        weapons: linesToArray(document.getElementById('weapons').value),
        armor: linesToArray(document.getElementById('armor').value),
        accessories: linesToArray(document.getElementById('accessories').value),
        special: linesToArray(document.getElementById('special').value),
      };
      const status = document.getElementById('status');
      status.textContent = 'Saving...';
      try {
        const resp = await fetch('/admin/museum', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ items }),
        });
        const json = await resp.json();
        if (!resp.ok || !json.success) {
          status.textContent = 'Failed to save dataset.';
          return;
        }
        status.textContent = 'Saved! Dataset updated.';
      } catch (e) {
        status.textContent = 'Unexpected error saving dataset.';
      }
    }

    document.getElementById('save').addEventListener('click', saveDataset);
  </script>
</body>
</html>